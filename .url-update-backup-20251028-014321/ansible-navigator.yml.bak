---
# Ansible Navigator Configuration for Validated Patterns Template
# Documentation: https://ansible.readthedocs.io/projects/navigator/settings/
# ADR: docs/adr/ADR-007-ansible-navigator-deployment.md

ansible-navigator:
  # Execution environment settings
  execution-environment:
    enabled: true
    container-engine: podman

    # Use the built execution environment image
    # Build with: make build
    # Or use published image: quay.io/validated-patterns/ansible-ee:latest
    image: localhost/ansible-ee:latest

    # Pull policy: missing, always, never, tag
    pull:
      policy: missing

    # Volume mounts for local development
    volume-mounts:
      # Mount ansible directory
      - src: "{PWD}/ansible"
        dest: "/runner/ansible"
        options: "Z"

      # Mount patterns directory
      - src: "{PWD}/patterns"
        dest: "/runner/patterns"
        options: "Z"

      # Mount gitea directory
      - src: "{PWD}/gitea"
        dest: "/runner/gitea"
        options: "Z"

      # Mount kubeconfig for OpenShift access
      - src: "{HOME}/.kube"
        dest: "/runner/.kube"
        options: "Z"

    # Environment variables to pass through
    environment-variables:
      pass:
        # Kubernetes/OpenShift authentication
        - KUBECONFIG
        - K8S_AUTH_KUBECONFIG

        # Ansible Hub token for collection downloads
        - ANSIBLE_HUB_TOKEN

        # Vault token for secrets management
        - VAULT_TOKEN

        # Pattern-specific variables
        - PATTERN_NAME
        - PATTERN_GIT_URL
        - PATTERN_GIT_BRANCH

        # Execution context (from ADR-006)
        - PATTERN_EXECUTION_CONTEXT
        - PATTERN_SUBDIRECTORY
        - PATTERN_PROJECT_ROOT

      set:
        # Ansible behavior
        ANSIBLE_FORCE_COLOR: "true"
        ANSIBLE_HOST_KEY_CHECKING: "false"
        ANSIBLE_STDOUT_CALLBACK: "yaml"

        # Default execution context
        PATTERN_EXECUTION_CONTEXT: "root"

  # Playbook artifact settings
  playbook-artifact:
    enable: true
    save-as: "artifacts/playbook-{playbook_name}-{time_stamp}.json"

  # Logging configuration
  logging:
    level: info
    append: true
    file: "logs/ansible-navigator.log"

  # Default mode: stdout for CI/CD, interactive for debugging
  # Override with: ansible-navigator run playbook.yml -m interactive
  mode: stdout

  # Color settings
  color:
    enable: true
    osc4: true

  # Editor for interactive mode
  editor:
    command: vim
    console: true

  # Time zone
  time-zone: UTC
