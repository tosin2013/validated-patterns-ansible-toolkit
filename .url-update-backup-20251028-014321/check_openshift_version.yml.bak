---
# Check OpenShift version is 4.12 or higher

- name: Get OpenShift version
  kubernetes.core.k8s_info:
    api_version: config.openshift.io/v1
    kind: ClusterVersion
    name: version
  register: openshift_version
  failed_when: openshift_version.resources | length == 0

- name: Extract version number
  set_fact:
    ocp_version: "{{ openshift_version.resources[0].status.desired.version.split('.')[0:2] | join('.') }}"

- name: Validate OpenShift version is 4.12 or higher
  assert:
    that:
      - ocp_version is version('4.12', '>=')
    fail_msg: "OpenShift version {{ ocp_version }} is not supported. Minimum required: 4.12"
    success_msg: "âœ… OpenShift version {{ ocp_version }} is supported"
