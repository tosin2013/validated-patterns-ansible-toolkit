# Default values for quarkus-reference-app
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Application name
name: reference-app

# Namespace configuration
namespace:
  name: reference-app
  create: true

# Number of replicas
replicaCount: 2

# Container image configuration
image:
  repository: quay.io/validated-patterns/reference-app
  tag: latest
  pullPolicy: Always

# Application configuration
config:
  profile: prod
  appConfig: |
    # Application configuration
    app.name=reference-app
    app.version=1.0.0
    app.environment=production

# Resource limits and requests
resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "256Mi"
    cpu: "500m"

# Service configuration
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  protocol: TCP
  name: http

# Route configuration (OpenShift)
route:
  enabled: true
  host: ""  # Auto-generated if empty
  tls:
    enabled: true
    termination: edge
    insecureEdgeTerminationPolicy: Redirect

# RBAC configuration
rbac:
  create: true
  rules:
    - apiGroups: [""]
      resources: ["configmaps"]
      verbs: ["get", "list", "watch"]
    - apiGroups: [""]
      resources: ["secrets"]
      verbs: ["get", "list"]

# ServiceAccount configuration
serviceAccount:
  create: true
  name: reference-app

# Health check configuration
healthChecks:
  liveness:
    enabled: true
    path: /health/live
    port: 8080
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
  readiness:
    enabled: true
    path: /health/ready
    port: 8080
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Security context
# Note: runAsUser is intentionally omitted to allow OpenShift to assign a UID
# from the namespace's allowed range (e.g., 1000800000-1000819999)
securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL

# Labels applied to all resources
labels:
  app: reference-app
  app.kubernetes.io/name: reference-app
  app.kubernetes.io/part-of: validated-patterns

# Annotations applied to all resources
annotations:
  validatedpatterns.io/pattern: quarkus-reference-app
  validatedpatterns.io/deployment-method: gitops

# ArgoCD sync wave annotations
# These control the order of resource deployment
syncWaves:
  namespace: "-1"      # Infrastructure
  imagestream: "-3"    # Build infrastructure
  buildconfig: "-2"    # Build infrastructure
  secret: "-2"         # Build secrets
  configmap: "0"       # Configuration
  serviceaccount: "0"  # Configuration
  role: "1"            # RBAC
  rolebinding: "1"     # RBAC
  deployment: "2"      # Workloads
  service: "3"         # Networking
  route: "3"           # Networking

# Build configuration
build:
  # Enable/disable build (set to false to use pre-built images)
  enabled: false

  # Git source repository
  git:
    uri: https://github.com/validated-patterns/validated-patterns-ansible-toolkit.git
    ref: main
    contextDir: quarkus-reference-app

  # Dockerfile path relative to contextDir
  dockerfilePath: src/main/docker/Dockerfile.jvm

  # Maven build arguments
  mavenArgs: "clean package -DskipTests"
  mavenMirrorUrl: ""

  # Output image tag
  outputTag: latest

  # Pull secret for base images (optional)
  pullSecret: ""

  # Build triggers
  triggers:
    configChange: true
    imageChange: true
    webhook: false

  # Webhook secret (generated if not provided)
  webhookSecret: ""

  # Build resource limits
  resources:
    limits:
      cpu: "2"
      memory: "4Gi"
    requests:
      cpu: "500m"
      memory: "2Gi"

  # Build timeout (30 minutes)
  completionDeadlineSeconds: 1800

  # Build history limits
  successfulBuildsHistoryLimit: 3
  failedBuildsHistoryLimit: 3
