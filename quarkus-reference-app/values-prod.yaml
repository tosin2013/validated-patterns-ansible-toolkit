# Production environment values for Quarkus Reference Application
# This file overrides values-global.yaml for production environments
# Use this for production clusters or production namespaces

# Production cluster group configuration
clusterGroup:
  name: production
  isHubCluster: false
  targetRevision: main

  # Production namespace
  namespaces:
    - quarkus-prod

  # Production applications
  applications:
    quarkus-reference-app:
      name: quarkus-reference-app
      namespace: quarkus-prod
      project: quarkus-reference
      path: quarkus-reference-app/charts/all/quarkus-reference-app
      repoURL: https://github.com/validatedpatterns/validated-patterns-ansible-toolkit.git
      targetRevision: main

      # Production sync policy - more conservative
      syncPolicy:
        automated:
          prune: false  # Manual pruning in production
          selfHeal: true
        syncOptions:
          - CreateNamespace=false
          - RespectIgnoreDifferences=true

      # Production overrides
      overrides:
        - name: namespace.create
          value: "false"
        - name: namespace.name
          value: quarkus-prod
        - name: replicaCount
          value: "3"  # High availability
        - name: image.tag
          value: v1.0.0  # Pinned version

# Production-specific Quarkus application configuration
# These values override the chart's default values.yaml

# High availability with 3 replicas
replicaCount: 3

# Production-grade resources
resources:
  requests:
    memory: "256Mi"
    cpu: "200m"
  limits:
    memory: "512Mi"
    cpu: "1000m"

# Production configuration
config:
  profile: prod
  appConfig: |
    # Application configuration
    app.name=reference-app-prod
    app.version=1.0.0
    app.environment=production

# Production image configuration
image:
  repository: quay.io/validated-patterns/reference-app
  tag: v1.0.0  # Pinned version for production
  pullPolicy: IfNotPresent  # Use cached images

# Service configuration
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

# Route configuration with custom domain
route:
  enabled: true
  host: reference-app.prod.example.com  # Custom production domain
  tls:
    enabled: true
    termination: edge
    insecureEdgeTerminationPolicy: Redirect

# RBAC (same as global)
rbac:
  create: true

# ServiceAccount (same as global)
serviceAccount:
  create: true
  name: reference-app

# Strict health checks for production
healthChecks:
  liveness:
    enabled: true
    path: /health/live
    port: 8080
    initialDelaySeconds: 10  # More time for startup
    periodSeconds: 10
    timeoutSeconds: 5  # Longer timeout
    failureThreshold: 3  # Strict failure threshold
  readiness:
    enabled: true
    path: /health/ready
    port: 8080
    initialDelaySeconds: 10  # More time for startup
    periodSeconds: 5
    timeoutSeconds: 5  # Longer timeout
    failureThreshold: 3  # Strict failure threshold

# Security context (same as global)
securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

# ArgoCD configuration for production
argocd:
  # Sync waves (same as global)
  syncWaves:
    namespace: "-1"
    configmap: "0"
    serviceaccount: "0"
    role: "1"
    rolebinding: "1"
    deployment: "2"
    service: "3"
    route: "3"

  # Conservative sync policy for production
  syncPolicy:
    automated:
      prune: false  # Manual pruning in production
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - RespectIgnoreDifferences=true
    retry:
      limit: 10  # More retries in production
      backoff:
        duration: 10s
        factor: 2
        maxDuration: 5m  # Longer max duration

# Production-specific labels
labels:
  app: reference-app
  app.kubernetes.io/name: reference-app
  app.kubernetes.io/part-of: validated-patterns
  app.kubernetes.io/component: application
  app.kubernetes.io/managed-by: argocd
  environment: production
  tier: prod
  criticality: high

# Production-specific annotations
annotations:
  validatedpatterns.io/pattern: quarkus-reference-app
  validatedpatterns.io/deployment-method: gitops
  validatedpatterns.io/environment: production
  validatedpatterns.io/sla: "99.9"

# Monitoring configuration (enabled in production)
monitoring:
  enabled: true
  namespace: openshift-monitoring

  # ServiceMonitor for Prometheus
  serviceMonitor:
    enabled: true
    interval: 30s
    path: /q/metrics
    scrapeTimeout: 10s

  # Alerts
  alerts:
    enabled: true
    rules:
      - alert: QuarkusAppDown
        expr: up{job="reference-app"} == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Quarkus application is down"
          description: "The Quarkus reference application has been down for more than 5 minutes"

      - alert: QuarkusAppHighMemory
        expr: container_memory_usage_bytes{pod=~"reference-app-.*"} > 450000000
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Quarkus application high memory usage"
          description: "Memory usage is above 450MB for more than 10 minutes"

# Backup configuration (enabled in production)
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # Keep 30 days of backups
  destination: s3://prod-backups/quarkus-reference-app

# Network policies (enabled in production)
networkPolicies:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: openshift-ingress
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 8080

# Pod Disruption Budget (production only)
podDisruptionBudget:
  enabled: true
  minAvailable: 2  # Always keep at least 2 pods running

# Horizontal Pod Autoscaler (production only)
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Production environment metadata
prod:
  # Production cluster metadata
  clusterName: prod-cluster
  clusterDomain: apps.prod.example.com

  # Production SLA
  sla:
    availability: "99.9%"
    responseTime: "200ms"
    errorRate: "0.1%"

  # Production features
  features:
    highAvailability: true
    autoScaling: true
    monitoring: true
    alerting: true
    backup: true
    disasterRecovery: true

  # Production labels
  labels:
    cluster-type: production
    environment: prod
    managed-by: validated-patterns
    criticality: high
    compliance: required
